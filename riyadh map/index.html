<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <title>Riyadh Taz Map</title>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="//d3js.org/queue.v1.min.js"></script>
    <script src="new_taz.json"></script>
    <script src="tweets.json"></script>
    <script src="roads.json"></script>
    <style>
        body {
            position: absolute;
            font-family: "Proxima Nova", "Montserrat", sans-serif;
        }
        h1, h2 {
            position: absolute;
            left: 10px;
            font-size: 1.3em;
            font-weight: 100;
        }
        h2 {
            top: 30px;
            font-size: 1em;
        }
        
        .hover {
            fill: yellow;
            z-index: 9999;
        }
        
        #sliderContainer {
            text-align: center;
            position: relative;
            top:850px;
        }
    </style>
</head>
<body bgcolor="#000058" text="white">
<h1>Hooray - A Map!</h1>
<h2></h2>
<div id="sliderContainer">
    <input id="timeslide" type="range" min="0" max="13642" value="0" step="1" style="width:1000px"/><br>
    <span id="sliderTitle">Riyadh's Tweets from:</span>
    <span id="range">10/07/15 - 10/14/15</span>
</div>

    <script>

    
    // Width and Height of the whole visualization
    var width = 1200;
    var height = 800;

    // Create SVG
    var svg = d3.select( "body" )
        .append( "svg" )
        .attr( "width", width )
        .attr( "height", height );

    // Append g element to the SVG
    // g will contain geometry elements
    var g = svg.append( "g" );
    var twitter = svg.append("g");

    // Set Projection Parameters
    var albersProjection = d3.geo.albers()
        .scale( 100000 )
        .rotate([-46.67,0])
        .center( [.03,24.6736] )
        .translate( [width/2,height/2] );
    
    var radius = d3.scale.linear()
        .domain([1e7, 4e9])
        .range([0,10]);
        
    var color = d3.scale.linear()
        .domain([0, 1e5])
        .range(["#00f5ed","white"]);
        
    var path = d3.geo.path()
        .projection(albersProjection)
        .pointRadius(4)
        //.pointRadius(function(d) { return radius(+d.properties.user);});
        
    

    // Create GeoPath function that uses built-in D3 functionality to turn
    // lat/lon coordinates into screen coordinates
    var geoPath = d3.geo.path()
        .projection( albersProjection );
    
    var format = d3.time.format("%A, %b %-dth at %-I%p");
    
    var format2 = d3.time.format("%A, %b %-dth at %-I:%M%p");
    
    var inputValue = null;
    
    
    
           
    
    // Classic D3... Select non-existent elements, bind the data, append the elements, and apply attributes
    
    g.selectAll( "path" )
        .data( roads.features )
        .enter()
        .append( "path" )
        .attr( "stroke", "#ccc" )
        .attr("fill", "none")
        .attr( "d", geoPath );
    
    twitter.selectAll( "path" )
        .data(tweets.features)
        .enter()
        .append( "path" )
        .attr("class", "points")
        .attr("d", path)
        .attr("fill", function(d) { return color(+d.properties.id);})
        .on("mouseover", function(d){
            d3.select("h2").text(format2(new Date(d.properties.time)));
            d3.select(this).attr("class","points hover").attr;
            this.parentElement.appendChild(this);
        })
        .on("mouseout", function(d){
            d3.select("h2").text("");
            d3.select(this).attr("class","points");
        });
    
    /*twitter.selectAll( "circle" )
        .data(tweets.features)
        .enter()
        .append( "circle" )
        .attr("class", "points")
        .attr("d", path)
        .attr("cx", function(d) { return d.geometry.coordinates[0];} )
        .attr("cy", function(d) { return d.geometry.coordinates[1];} )
        .attr("r", 10)
        .attr("fill", function(d) { return color(+d.properties.id);})
        .on("mouseover", function(d){
            d3.select("h2").text(format(new Date(d.properties.time)));
            d3.select(this).attr("class","points hover").attr;
            this.parentElement.appendChild(this);
        })
        .on("mouseout", function(d){
            d3.select("h2").text("");
            d3.select(this).attr("class","points");
        });*/
    
    

    
    
    var timeArray = []
    for (i = 0; i<tweets.features.length; i++) {
        timeArray.push(new Date(tweets.features[i].properties.time));}
    
    var date_sort_asc = function (date1, date2) {
        if (date1 > date2) return 1;
        if (date1<date2) return -1;
        return 0;
        };
    
    timeArray.sort(date_sort_asc);
    
    
    for (i = 0; i<tweets.features.length; i++) {
        timeArray[i] = format(timeArray[i]);
    }
    
    // when the input range changes update the value 
    d3.select("#timeslide").on("input", function() {
        update(+this.value);
    });
    
    // update the fill of each SVG of class "incident" with value
    function update(value) {
        document.getElementById("range").innerHTML=timeArray[value];
        inputValue = timeArray[value];
        d3.selectAll(".points")
            .attr("fill", dateMatch);
    }
    
    function dateMatch(data, value) {
    var d = format(new Date(data.properties.time));
    if (inputValue == d) {
        this.parentElement.appendChild(this);
        return "#00f5ed";
    } else {
        return "none";
    };
}
    
    //for (i = 0; i < tweets.features.length; i++) {
    //    console.log(format(new Date(tweets.features[i].properties.time)));
    //}
    
    //console.log(tweets.features.properties.time)
    /*console.log(tweets.features[0].properties.time);
    console.log(String(tweets.features[0].properties.time));
    console.log(new Date(tweets.features[0].properties.time));
    console.log(format(new Date(tweets.features[0].properties.time)));
    for (i = 0; i<10; i++) {
        console.log(tweets.features[i].geometry.coordinates[0]);}
    console.log(tweets.features.length);*/
    
    
       
    </script>
    
</body>
